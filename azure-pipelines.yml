trigger:
- master

pr:
- master

pool:
  vmImage: 'win1803'

steps:
- task: PowerShell@2
  displayName: 'Run Integration Tests'
  inputs:
    targetType: filePath
    filePath: ./cicd/run.ps1
    workingDirectory: cicd
  env:
    COSMOSDB_DATA_PATH: $(Build.BinariesDirectory)\CosmosDBEmulator\bind-mount\
    SOURCES: $(Build.SourcesDirectory)
- task: PublishTestResults@2
  inputs:
    testRunner: JUnit
    testResultsFiles: $(Build.BinariesDirectory)/**/report.xml
- task: PublishCodeCoverageResults@1
  inputs:
    codeCoverageTool: Cobertura
    summaryFileLocation: $(Build.BinariesDirectory)/**/coverage.xml
    reportDirectory: $(Build.BinariesDirectory)/**/coverage